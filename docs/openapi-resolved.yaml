openapi: 3.0.0
info:
  title: Inventory Management System API
  description: Full API documentation with standardized response wrappers (success, message, data).
  version: 1.0.0
servers:
  - url: http://localhost/api
    description: Local Development Server

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: PHPSESSID

  schemas:
    # --- RESPONSE WRAPPERS ---
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Resource not found or invalid request"

    # --- DATA MODELS ---
    User:
      type: object
      properties:
        userId: { type: integer }
        username: { type: string }
        email: { type: string, format: email }
        role: { type: string, enum: [manager, picker, supplier, admin] }
        isActive: { type: boolean }

    Supplier:
      type: object
      properties:
        id: { type: string, example: "1" }
        userId: { type: string, example: "1" }
        name: { type: string, example: "Supplier One Updated" }
        email: { type: string, example: "supplier1@updated.com" }
        address: { type: string, example: "123 Supplier St, Toronto, ON" }
        phone: { type: string, example: "+1-555-111-2222" }
        createdAt: { type: string, example: "2025-12-12 12:49:15" }
        updatedAt: { type: string, example: "2025-12-12 20:38:23" }

    Product:
      type: object
      properties:
        id: { type: integer }
        sku: { type: string }
        name: { type: string }
        category: { type: string }
        brand: { type: string }
        supplierId: { type: integer }
        price: { type: number, format: float }
        inStock: { type: integer }
        NextExpirationDate: { type: string, format: date }
        createdAt: { type: string, format: date-time }

    PurchaseOrder:
      type: object
      properties:
        id: { type: integer }
        supplierId: { type: integer }
        totalAmount: { type: number, format: float }
        status: { type: string, example: "Pending" }
        orderDate: { type: string, format: date }
        items:
          type: array
          items:
            $ref: '#/components/schemas/PurchaseOrderItem'

    PurchaseOrderItem:
      type: object
      properties:
        productId: { type: integer }
        quantity: { type: integer }
        unitPrice: { type: number }
        lineTotal: { type: number }

    # --- REQUEST SCHEMAS (BODY) ---
    UserRegisterRequest:
      required: [username, email, password, role]
      properties:
        username: { type: string }
        email: { type: string }
        password: { type: string }
        role: { type: string, enum: [manager, picker, supplier, admin] }

    LoginRequest:
      required: [email, password]
      properties:
        email: { type: string }
        password: { type: string }

    SupplierCreateRequest:
      required: [username, email, password, role, name, address, phone]
      properties:
        username: { type: string }
        email: { type: string }
        password: { type: string }
        role: { type: string, default: supplier }
        name: { type: string }
        address: { type: string }
        phone: { type: string }

    ProductCreateRequest:
      required: [sku, name, price]
      properties:
        sku: { type: string }
        name: { type: string }
        category: { type: string }
        brand: { type: string }
        supplierId: { type: integer }
        price: { type: number }
        inStock: { type: integer }
        NextExpirationDate: { type: string, format: date }

    PurchaseOrderCreateRequest:
      required: [supplierId, items]
      properties:
        supplierId: { type: integer }
        items:
          type: array
          items:
            type: object
            required: [productId, quantity]
            properties:
              productId: { type: integer }
              quantity: { type: integer }

security:
  - cookieAuth: []

paths:
  # =======================
  # AUTH
  # =======================
  /auth/register:
    post:
      tags: [Auth]
      summary: Register a new user
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UserRegisterRequest' }
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "User registered successfully." }
        400:
          description: Error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }

  /auth/login:
    post:
      tags: [Auth]
      summary: Login user
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/LoginRequest' }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "User logged in successfully." }

  /auth/logout:
    post:
      tags: [Auth]
      summary: Logout user
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "User logged out successfully." }

  # =======================
  # SUPPLIERS
  # =======================
  /suppliers:
    get:
      tags: [Suppliers]
      summary: Get all suppliers
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "List of suppliers fetched successfully." }
                  data:
                    type: object
                    properties:
                      suppliers:
                        type: array
                        items: { $ref: '#/components/schemas/Supplier' }
    post:
      tags: [Suppliers]
      summary: Create a new supplier
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SupplierCreateRequest' }
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Supplier created successfully." }
                  data:
                    type: object
                    properties:
                      id: { type: integer }
                      userId: { type: integer }

  /suppliers/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: integer }
    get:
      tags: [Suppliers]
      summary: Get supplier by ID
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Supplier details fetched successfully." }
                  data: { $ref: '#/components/schemas/Supplier' }
        404:
          description: Error
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ErrorResponse' }
    put:
      tags: [Suppliers]
      summary: Update supplier
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                email: { type: string }
                address: { type: string }
                phone: { type: string }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Supplier updated successfully." }
    delete:
      tags: [Suppliers]
      summary: Delete supplier
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Supplier deleted successfully." }

  # =======================
  # PRODUCTS
  # =======================
  /products:
    get:
      tags: [Products]
      summary: Get all products
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "List of products fetched successfully." }
                  data:
                    type: object
                    properties:
                      products:
                        type: array
                        items: { $ref: '#/components/schemas/Product' }
    post:
      tags: [Products]
      summary: Create a new product
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ProductCreateRequest' }
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Product created successfully." }
                  data:
                    type: object
                    properties:
                      id: { type: integer }

  /products/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: integer }
    get:
      tags: [Products]
      summary: Get product by ID
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Product details fetched successfully." }
                  data: { $ref: '#/components/schemas/Product' }
    put:
      tags: [Products]
      summary: Update product
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/ProductCreateRequest' }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Product updated successfully." }
    delete:
      tags: [Products]
      summary: Delete product
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Product deleted successfully." }

  # =======================
  # PURCHASE ORDERS
  # =======================
  /purchase-orders:
    get:
      tags: [PurchaseOrders]
      summary: Get all purchase orders
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "List of purchase orders fetched successfully." }
                  data:
                    type: object
                    properties:
                      purchaseOrders:
                        type: array
                        items: { $ref: '#/components/schemas/PurchaseOrder' }
    post:
      tags: [PurchaseOrders]
      summary: Create a purchase order
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PurchaseOrderCreateRequest' }
      responses:
        201:
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Purchase order created successfully." }
                  data:
                    type: object
                    properties:
                      id: { type: integer }

  /purchase-orders/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: integer }
    get:
      tags: [PurchaseOrders]
      summary: Get order by ID
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Purchase order details fetched successfully." }
                  data: { $ref: '#/components/schemas/PurchaseOrder' }
    put:
      tags: [PurchaseOrders]
      summary: Update order status
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status: { type: string, enum: [Pending, Received, Cancelled] }
                totalAmount: { type: number }
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Purchase order updated successfully." }
    delete:
      tags: [PurchaseOrders]
      summary: Delete order
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Purchase order deleted successfully." }

  # =======================
  # DASHBOARD
  # =======================
  /dashboard/summary:
    get:
      tags: [Dashboard]
      summary: Get dashboard summary
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "Dashboard summary fetched successfully." }
                  data:
                    type: object
                    properties:
                      inventory:
                        type: object
                        properties:
                          totalProducts: { type: integer }
                          inventoryValue: { type: number }
                      lowStockCount: { type: integer }
                      orders:
                        type: array
                        items:
                          type: object
                          properties:
                            Status: { type: string }
                            count: { type: integer }
                      topSupplierSpend:
                        type: array
                        items:
                          type: object
                          properties:
                            supplierName: { type: string }
                            totalSpent: { type: number }